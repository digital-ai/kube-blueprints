{{- if hasPrefix "Openshift" .K8sSetup }}
  {{- if and .EnableSCC (eq .IngressType "ingress-nginx-controller") }}
---
  {{- $postgresqlFullName := printf "dai-ocp-%s-ingress-nginx" .ShortServerName }}
  {{- if ne .Namespace "digitalai" }}
    {{- $postgresqlFullName = printf "dai-ocp-%s-%s-ingress-nginx" .ShortServerName .Namespace }}
  {{- end }}
apiVersion: security.openshift.io/v1
kind: SecurityContextConstraints
metadata:
  name: {{ $postgresqlFullName }}
  namespace: {{ .Namespace }}
allowHostDirVolumePlugin: false
allowHostIPC: false
allowHostNetwork: false
allowHostPID: false
allowHostPorts: false
allowPrivilegeEscalation: false
allowPrivilegedContainer: false
allowedCapabilities:
  - NET_BIND_SERVICE
defaultAddCapabilities: null
fsGroup:
  type: RunAsAny
groups: []
priority: 100
readOnlyRootFilesystem: true
requiredDropCapabilities:
  - ALL
runAsUser:
  type: RunAsAny
seLinuxContext:
  type: MustRunAs
seccompProfiles:
  - runtime/default
supplementalGroups:
  type: RunAsAny
users:
- system:serviceaccount:{{ .Namespace }}:ingress-nginx-admission
- system:serviceaccount:{{ .Namespace }}:ingress-nginx
volumes:
  - configMap
  - csi
  - downwardAPI
  - emptyDir
  - ephemeral
  - persistentVolumeClaim
  - projected
  - secret
  {{- end }}
{{- end }}
